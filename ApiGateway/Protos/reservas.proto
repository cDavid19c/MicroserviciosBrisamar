syntax = "proto3";

option csharp_namespace = "ReservasService.Protos";

package reservas;

// ================== MENSAJES COMUNES ==================
message Empty {}
service ReservasGrpc {

  // ================== RESERVA ==================
  rpc ObtenerReservas (Empty) returns (ReservasResponse);
  rpc ObtenerReservaPorId (ReservaIdRequest) returns (ReservaResponse);
  rpc CrearReserva (ReservaCreateRequest) returns (ReservaResponse);
  rpc ActualizarReserva (ReservaUpdateRequest) returns (ReservaResponse);
  rpc EliminarReserva (ReservaIdRequest) returns (BoolResponse);

  // ================== HABXRES ==================
  rpc ObtenerHabxRes (Empty) returns (HabxResListResponse);
  rpc ObtenerHabxResPorReserva (ReservaIdRequest) returns (HabxResListResponse);
  rpc CrearHabxRes (HabxResCreateRequest) returns (HabxResResponse);
  rpc EliminarHabxRes (HabxResIdRequest) returns (BoolResponse);

  // ================== DESXHABXRES ==================
  rpc ObtenerDesxHabxResPorHabxRes (HabxResIdRequest) returns (DesxHabxResListResponse);
  rpc CrearDesxHabxRes (DesxHabxResCreateRequest) returns (DesxHabxResResponse);
  rpc EliminarDesxHabxRes (DesxHabxResIdRequest) returns (BoolResponse);

  // ================== HOLD ==================
  rpc ObtenerHolds (Empty) returns (HoldsResponse);
  rpc ObtenerHoldPorId (HoldIdRequest) returns (HoldResponse);
  rpc ObtenerHoldsPorHabitacion (HabitacionIdRequest) returns (HoldsResponse);
  rpc CrearHold (HoldCreateRequest) returns (HoldResponse);
  rpc ActualizarHold (HoldUpdateRequest) returns (HoldResponse);
  rpc EliminarHold (HoldIdRequest) returns (BoolResponse);
}
message BoolResponse {
  bool success = 1;
  string message = 2;
}
// ================== RESERVA ==================

// ---- Mensaje principal ----
message ReservaMessage {
  int32 id_reserva = 1;
  int32 id_usuario = 2;            // 0 si no aplica
  int32 id_usuario_externo = 3;    // 0 si no aplica
  double costo_total = 4;
  string fecha_registro = 5;       // ISO-8601
  string fecha_inicio = 6;         // ISO-8601
  string fecha_final = 7;          // ISO-8601
  string estado_general = 8;       // PRE-RESERVA | CONFIRMADO | CANCELADO
  bool estado = 9;
  string fecha_modificacion = 10;  // ISO-8601
}

// ---- Crear ----
message ReservaCreateRequest {
  int32 id_usuario = 1;
  int32 id_usuario_externo = 2;
  string fecha_inicio = 3;
  string fecha_final = 4;
  string estado_general = 5;
  bool estado = 6;
}

// ---- Actualizar ----
message ReservaUpdateRequest {
  int32 id_reserva = 1;
  string estado_general = 2;
  bool estado = 3;
}

message ReservaIdRequest {
  int32 id_reserva = 1;
}


// ---- Responses ----
message ReservasResponse {
  repeated ReservaMessage reservas = 1;
}

message ReservaResponse {
  bool success = 1;
  string message = 2;
  ReservaMessage reserva = 3;
}
// ================== HABXRES ==================

// ---- Mensaje principal ----
message HabxResMessage {
  int32 id_habxres = 1;
  string id_habitacion = 2;     // char(10)
  int32 id_reserva = 3;
  int32 capacidad = 4;
  double costo_calculado = 5;
  double descuento = 6;
  double impuestos = 7;
  bool estado = 8;
  string fecha_modificacion = 9; // ISO-8601
}

// ---- Crear ----
message HabxResCreateRequest {
  string id_habitacion = 1;     // char(10)
  int32 id_reserva = 2;
  int32 capacidad = 3;
  double costo_calculado = 4;
  double descuento = 5;
  double impuestos = 6;
  bool estado = 7;
}

// ---- IDs ----
message HabxResIdRequest {
  int32 id_habxres = 1;
}

// ---- Responses ----
message HabxResListResponse {
  repeated HabxResMessage items = 1;
}

message HabxResResponse {
  bool success = 1;
  string message = 2;
  HabxResMessage item = 3;
}



// ================== DESXHABXRES ==================

// ---- Mensaje principal ----
message DesxHabxResMessage {
  int32 id_habxres = 1;
  int32 id_descuento = 2;
  double monto = 3;
  bool estado = 4;
  string fecha_modificacion = 5; // ISO-8601
}

// ---- Crear ----
message DesxHabxResCreateRequest {
  int32 id_habxres = 1;
  int32 id_descuento = 2;
  double monto = 3;
  bool estado = 4;
}

// ---- IDs (clave compuesta) ----
message DesxHabxResIdRequest {
  int32 id_habxres = 1;
  int32 id_descuento = 2;
}

// ---- Responses ----
message DesxHabxResListResponse {
  repeated DesxHabxResMessage items = 1;
}

message DesxHabxResResponse {
  bool success = 1;
  string message = 2;
  DesxHabxResMessage item = 3;
}
// ================== HOLD ==================

// ---- Mensaje principal ----
message HoldMessage {
  string id_hold = 1;          // char(10)
  string id_habitacion = 2;    // char(10)
  int32 id_reserva = 3;
  int32 tiempo_hold = 4;
  string fecha_inicio = 5;     // ISO-8601
  string fecha_final = 6;      // ISO-8601
  bool estado = 7;
}

// ---- Crear ----
message HoldCreateRequest {
  string id_hold = 1;
  string id_habitacion = 2;
  int32 id_reserva = 3;
  int32 tiempo_hold = 4;
  string fecha_inicio = 5;
  string fecha_final = 6;
  bool estado = 7;
}

// ---- Actualizar (solo lo que realmente cambia) ----
message HoldUpdateRequest {
  string id_hold = 1;
  bool estado = 2;
}

// ---- IDs ----
message HoldIdRequest {
  string id_hold = 1;
}

message HabitacionIdRequest {
  string id_habitacion = 1;
}

// ---- Responses ----
message HoldsResponse {
  repeated HoldMessage holds = 1;
}

message HoldResponse {
  bool success = 1;
  string message = 2;
  HoldMessage hold = 3;
}
